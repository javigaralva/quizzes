{
  "algorithm": {
    "parameters": [
      {
        "name": "gameId",
        "type": "integer"
      }
    ],
    "statements": [
      {
        "command": "Set",
        "expression": "GetTopicNameByGameId( gameId )",
        "variableName": "topicName"
      },
      {
        "command": "Set",
        "expression": "GetScore( gameId )",
        "variableName": "score"
      },
      {
        "command": "Set",
        "expression": "GetCurrentRoundNumber( gameId )",
        "variableName": "currentRound"
      },
      {
        "command": "Set",
        "expression": "GetTotalRoundsPerGame()",
        "variableName": "totalRounds"
      },
      {
        "children": [
          {
            "command": "Set",
            "expression": "totalRounds",
            "variableName": "currentRound"
          }
        ],
        "command": "If",
        "expression": "currentRound > totalRounds"
      },
      {
        "command": "Set",
        "expression": "GetLastRound( gameId )",
        "variableName": "round"
      },
      {
        "command": "ConsoleLog",
        "expression": "{topicName:topicName, score:score, currentRound:currentRound, totalRounds:totalRounds, round:round}"
      },
      {
        "children": [
          {
            "command": "Set",
            "expression": "GetRandomQuiz( gameId )",
            "variableName": "quiz"
          },
          {
            "command": "ConsoleLog",
            "expression": "[\"random quiz\", quiz]"
          },
          {
            "children": [
              {
                "command": "Throw",
                "errorName": "NotFound",
                "expressionData": "\"Can't get a random quiz\"",
                "expressionInnerError": "null"
              }
            ],
            "command": "If",
            "expression": "IsNull( quiz )"
          },
          {
            "command": "Set",
            "expression": "{}",
            "variableName": "round"
          },
          {
            "command": "Set",
            "expression": "gameId",
            "variableName": "round.gameId"
          },
          {
            "command": "Set",
            "expression": "quiz.quizId",
            "variableName": "round.quizId"
          },
          {
            "command": "Set",
            "expression": "Now()",
            "variableName": "round.startTime"
          },
          {
            "command": "Execute",
            "expression": "CreateRound( round )"
          }
        ],
        "command": "If",
        "expression": "IsRoundEnded( round )"
      },
      {
        "children": [
          {
            "command": "Set",
            "expression": "round.quiz",
            "variableName": "quiz"
          }
        ],
        "command": "Else"
      },
      {
        "command": "Set",
        "expression": "{}",
        "variableName": "gameState"
      },
      {
        "command": "Set",
        "expression": "gameId",
        "variableName": "gameState.gameId"
      },
      {
        "command": "Set",
        "expression": "score",
        "variableName": "gameState.score"
      },
      {
        "command": "Set",
        "expression": "currentRound",
        "variableName": "gameState.currentRound"
      },
      {
        "command": "Set",
        "expression": "totalRounds",
        "variableName": "gameState.totalRounds"
      },
      {
        "command": "Set",
        "expression": "{}",
        "variableName": "gameState.currentQuiz"
      },
      {
        "command": "Set",
        "expression": "quiz.question",
        "variableName": "gameState.currentQuiz.question"
      },
      {
        "command": "Set",
        "expression": "quiz.answer1",
        "variableName": "gameState.currentQuiz.answer1"
      },
      {
        "command": "Set",
        "expression": "quiz.answer2",
        "variableName": "gameState.currentQuiz.answer2"
      },
      {
        "command": "Set",
        "expression": "quiz.answer3",
        "variableName": "gameState.currentQuiz.answer3"
      },
      {
        "command": "Set",
        "expression": "quiz.answer4",
        "variableName": "gameState.currentQuiz.answer4"
      },
      {
        "command": "Set",
        "expression": "topicName",
        "variableName": "gameState.currentQuiz.topic"
      },
      {
        "command": "Return",
        "expression": "gameState"
      }
    ],
    "typeReturn": "GameState",
    "variables": [
      {
        "name": "gameState",
        "type": "GameState"
      },
      {
        "name": "score",
        "type": "integer"
      },
      {
        "name": "currentRound",
        "type": "integer"
      },
      {
        "name": "totalRounds",
        "type": "integer"
      },
      {
        "name": "currentQuiz",
        "type": "RoundQuiz"
      },
      {
        "name": "randomQuiz",
        "type": "Quiz"
      },
      {
        "name": "round",
        "type": "Round"
      },
      {
        "name": "quiz",
        "type": "Quiz"
      },
      {
        "name": "topicName",
        "type": "string"
      }
    ]
  },
  "routing": {
    "method": "POST",
    "parameters": [
      {
        "bind": "gameId",
        "in": "Path",
        "name": "gameId",
        "remarks": "The gameId of the current round"
      }
    ],
    "path": "/start-round/{gameId}",
    "remarks": "Starts (or continue) a new round"
  }
}